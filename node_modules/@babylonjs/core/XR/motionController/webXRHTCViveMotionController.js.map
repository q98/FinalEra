{"version":3,"file":"webXRHTCViveMotionController.js","sourceRoot":"","sources":["../../../../sourceES6/core/XR/motionController/webXRHTCViveMotionController.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n    IMotionControllerLayoutMap,\r\n    IMinimalMotionControllerObject,\r\n    MotionControllerHandness,\r\n    WebXRAbstractMotionController\r\n} from \"./webXRAbstractMotionController\";\r\nimport { Scene } from '../../scene';\r\nimport { AbstractMesh } from '../../Meshes/abstractMesh';\r\nimport { Mesh } from '../../Meshes/mesh';\r\nimport { Quaternion } from '../../Maths/math.vector';\r\nimport { WebXRMotionControllerManager } from './webXRMotionControllerManager';\r\n\r\n/**\r\n * The motion controller class for the standard HTC-Vive controllers\r\n */\r\nexport class WebXRHTCViveMotionController extends WebXRAbstractMotionController {\r\n    private _modelRootNode: AbstractMesh;\r\n\r\n    /**\r\n     * The base url used to load the left and right controller models\r\n     */\r\n    public static MODEL_BASE_URL: string = 'https://controllers.babylonjs.com/vive/';\r\n    /**\r\n     * File name for the controller model.\r\n     */\r\n    public static MODEL_FILENAME: string = 'wand.babylon';\r\n\r\n    public profileId = \"htc-vive\";\r\n\r\n    /**\r\n     * Create a new Vive motion controller object\r\n     * @param scene the scene to use to create this controller\r\n     * @param gamepadObject the corresponding gamepad object\r\n     * @param handness the handness of the controller\r\n     */\r\n    constructor(scene: Scene,\r\n        gamepadObject: IMinimalMotionControllerObject,\r\n        handness: MotionControllerHandness) {\r\n        super(scene, HTCViveLayout[handness], gamepadObject, handness);\r\n    }\r\n\r\n    protected _getFilenameAndPath(): { filename: string; path: string; } {\r\n        let filename = WebXRHTCViveMotionController.MODEL_FILENAME;\r\n        let path = WebXRHTCViveMotionController.MODEL_BASE_URL;\r\n\r\n        return {\r\n            filename,\r\n            path\r\n        };\r\n    }\r\n\r\n    protected _getModelLoadingConstraints(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected _processLoadedModel(_meshes: AbstractMesh[]): void {\r\n        this.getComponentIds().forEach((id) => {\r\n            const comp = id && this.getComponent(id);\r\n            if (comp) {\r\n                comp.onButtonStateChangedObservable.add((component) => {\r\n                    if (!this.rootMesh || this.disableAnimation) { return; }\r\n\r\n                    switch (id) {\r\n                        case \"xr-standard-trigger\":\r\n                            (<AbstractMesh>(this._modelRootNode.getChildren()[6])).rotation.x = -component.value * 0.15;\r\n                            return;\r\n                        case \"xr-standard-touchpad\":\r\n                            return;\r\n                        case \"xr-standard-squeeze\":\r\n                            return;\r\n                    }\r\n                }, undefined, true);\r\n            }\r\n        });\r\n    }\r\n\r\n    protected _setRootMesh(meshes: AbstractMesh[]): void {\r\n        this.rootMesh = new Mesh(this.profileId + \" \" + this.handness, this.scene);\r\n\r\n        meshes.forEach((mesh) => { mesh.isPickable = false; });\r\n        this._modelRootNode = meshes[1];\r\n        this._modelRootNode.parent = this.rootMesh;\r\n        this.rootMesh.rotationQuaternion = Quaternion.FromEulerAngles(0, Math.PI, 0);\r\n    }\r\n\r\n    protected _updateModel(): void {\r\n        // no-op. model is updated using observables.\r\n    }\r\n}\r\n\r\n// register the profile\r\nWebXRMotionControllerManager.RegisterController(\"htc-vive\", (xrInput: XRInputSource, scene: Scene) => {\r\n    return new WebXRHTCViveMotionController(scene, <any>(xrInput.gamepad), xrInput.handedness);\r\n});\r\n\r\n// WebXRMotionControllerManager.RegisterController(\"htc-vive-legacy\", (xrInput: XRInputSource, scene: Scene) => {\r\n//     return new WebXRHTCViveMotionController(scene, <any>(xrInput.gamepad), xrInput.handedness, true);\r\n// });\r\n\r\nconst HTCViveLayout: IMotionControllerLayoutMap = {\r\n    \"left\": {\r\n        \"selectComponentId\": \"xr-standard-trigger\",\r\n        \"components\": {\r\n            \"xr-standard-trigger\": {\r\n                \"type\": \"trigger\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 0\r\n                },\r\n                \"rootNodeName\": \"xr_standard_trigger\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-squeeze\": {\r\n                \"type\": \"squeeze\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_squeeze\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-touchpad\": {\r\n                \"type\": \"touchpad\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 2,\r\n                    \"xAxis\": 0,\r\n                    \"yAxis\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_touchpad\",\r\n                \"visualResponses\": {\r\n                },\r\n            },\r\n            \"menu\": {\r\n                \"type\": \"button\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 4\r\n                },\r\n                \"rootNodeName\": \"menu\",\r\n                \"visualResponses\": {\r\n                }\r\n            }\r\n        },\r\n        \"gamepadMapping\": \"xr-standard\",\r\n        \"rootNodeName\": \"htc_vive_none\",\r\n        \"assetPath\": \"none.glb\"\r\n    },\r\n    \"right\": {\r\n        \"selectComponentId\": \"xr-standard-trigger\",\r\n        \"components\": {\r\n            \"xr-standard-trigger\": {\r\n                \"type\": \"trigger\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 0\r\n                },\r\n                \"rootNodeName\": \"xr_standard_trigger\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-squeeze\": {\r\n                \"type\": \"squeeze\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_squeeze\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-touchpad\": {\r\n                \"type\": \"touchpad\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 2,\r\n                    \"xAxis\": 0,\r\n                    \"yAxis\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_touchpad\",\r\n                \"visualResponses\": {\r\n                },\r\n            },\r\n            \"menu\": {\r\n                \"type\": \"button\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 4\r\n                },\r\n                \"rootNodeName\": \"menu\",\r\n                \"visualResponses\": {\r\n                }\r\n            }\r\n        },\r\n        \"gamepadMapping\": \"xr-standard\",\r\n        \"rootNodeName\": \"htc_vive_none\",\r\n        \"assetPath\": \"none.glb\"\r\n    },\r\n    \"none\": {\r\n        \"selectComponentId\": \"xr-standard-trigger\",\r\n        \"components\": {\r\n            \"xr-standard-trigger\": {\r\n                \"type\": \"trigger\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 0\r\n                },\r\n                \"rootNodeName\": \"xr_standard_trigger\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-squeeze\": {\r\n                \"type\": \"squeeze\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_squeeze\",\r\n                \"visualResponses\": {\r\n                }\r\n            },\r\n            \"xr-standard-touchpad\": {\r\n                \"type\": \"touchpad\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 2,\r\n                    \"xAxis\": 0,\r\n                    \"yAxis\": 1\r\n                },\r\n                \"rootNodeName\": \"xr_standard_touchpad\",\r\n                \"visualResponses\": {\r\n                },\r\n            },\r\n            \"menu\": {\r\n                \"type\": \"button\",\r\n                \"gamepadIndices\": {\r\n                    \"button\": 4\r\n                },\r\n                \"rootNodeName\": \"menu\",\r\n                \"visualResponses\": {\r\n                }\r\n            }\r\n        },\r\n        \"gamepadMapping\": \"xr-standard\",\r\n        \"rootNodeName\": \"htc-vive-none\",\r\n        \"assetPath\": \"none.glb\"\r\n    }\r\n};\r\n"]}