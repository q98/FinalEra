{"version":3,"file":"nativeEngine.js","sourceRoot":"","sources":["../../../sourceES6/core/Engines/nativeEngine.ts"],"names":[],"mappings":"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","sourcesContent":["import { Nullable, IndicesArray, DataArray } from \"../types\";\r\nimport { Engine } from \"../Engines/engine\";\r\nimport { VertexBuffer } from \"../Meshes/buffer\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport { IInternalTextureLoader } from \"../Materials/Textures/internalTextureLoader\";\r\nimport { Texture } from \"../Materials/Textures/texture\";\r\nimport { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport { VideoTexture } from \"../Materials/Textures/videoTexture\";\r\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport { DataBuffer } from '../Meshes/dataBuffer';\r\nimport { Tools } from \"../Misc/tools\";\r\nimport { Observer } from \"../Misc/observable\";\r\nimport { EnvironmentTextureTools, EnvironmentTextureSpecularInfoV1 } from \"../Misc/environmentTextureTools\";\r\nimport { Matrix, Viewport, Color3 } from \"../Maths/math\";\r\nimport { IColor4Like } from '../Maths/math.like';\r\nimport { Scene } from \"../scene\";\r\nimport { RenderTargetCreationOptions } from \"../Materials/Textures/renderTargetCreationOptions\";\r\nimport { IPipelineContext } from './IPipelineContext';\r\nimport { WebRequest } from '../Misc/webRequest';\r\nimport { NativeShaderProcessor } from './Native/nativeShaderProcessor';\r\nimport { Logger } from \"../Misc/logger\";\r\n\r\nimport { ThinEngine, ISceneLike } from './thinEngine';\r\nimport { IWebRequest } from '../Misc/interfaces/iWebRequest';\r\n\r\ninterface INativeEngine {\r\n    requestAnimationFrame(callback: () => void): void;\r\n\r\n    createVertexArray(): any;\r\n    deleteVertexArray(vertexArray: any): void;\r\n    bindVertexArray(vertexArray: any): void;\r\n\r\n    createIndexBuffer(data: ArrayBufferView): any;\r\n    deleteIndexBuffer(buffer: any): void;\r\n    recordIndexBuffer(vertexArray: any, buffer: any): void;\r\n\r\n    createVertexBuffer(data: ArrayBufferView): any;\r\n    deleteVertexBuffer(buffer: any): void;\r\n    recordVertexBuffer(vertexArray: any, buffer: any, location: number, byteOffset: number, byteStride: number, numElements: number, type: number, normalized: boolean): void;\r\n\r\n    createProgram(vertexShader: string, fragmentShader: string): any;\r\n    getUniforms(shaderProgram: any, uniformsNames: string[]): WebGLUniformLocation[];\r\n    getAttributes(shaderProgram: any, attributeNames: string[]): number[];\r\n    setProgram(program: any): void;\r\n\r\n    setState(culling: boolean, zOffset: number, reverseSide: boolean): void;\r\n    setZOffset(zOffset: number): void;\r\n    getZOffset(): number;\r\n    setDepthTest(enable: boolean): void;\r\n    getDepthWrite(): boolean;\r\n    setDepthWrite(enable: boolean): void;\r\n    setColorWrite(enable: boolean): void;\r\n    setBlendMode(blendMode: number): void;\r\n\r\n    setMatrix(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setInt(uniform: WebGLUniformLocation, int: number): void;\r\n    setIntArray(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray2(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray3(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray4(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setFloatArray(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray2(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray3(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray4(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setMatrices(uniform: WebGLUniformLocation, matrices: Float32Array): void;\r\n    setMatrix3x3(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setMatrix2x2(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setFloat(uniform: WebGLUniformLocation, value: number): void;\r\n    setFloat2(uniform: WebGLUniformLocation, x: number, y: number): void;\r\n    setFloat3(uniform: WebGLUniformLocation, x: number, y: number, z: number): void;\r\n    setFloat4(uniform: WebGLUniformLocation, x: number, y: number, z: number, w: number): void;\r\n\r\n    createTexture(): WebGLTexture;\r\n    loadTexture(texture: WebGLTexture, buffer: ArrayBuffer | ArrayBufferView | Blob, mipMap: boolean, invertY: boolean): boolean;\r\n    loadEnvTexture(texture: WebGLTexture, data: Array<Array<ArrayBufferView>>): boolean;\r\n    loadCubeTexture(texture: WebGLTexture, data: Array<ArrayBufferView>, generateMipMaps: boolean): boolean;\r\n    getTextureWidth(texture: WebGLTexture): number;\r\n    getTextureHeight(texture: WebGLTexture): number;\r\n    setTextureSampling(texture: WebGLTexture, filter: number): void; // filter is a NativeFilter.XXXX value.\r\n    setTextureWrapMode(texture: WebGLTexture, addressModeU: number, addressModeV: number, addressModeW: number): void; // addressModes are NativeAddressMode.XXXX values.\r\n    setTextureAnisotropicLevel(texture: WebGLTexture, value: number): void;\r\n    setTexture(uniform: WebGLUniformLocation, texture: Nullable<WebGLTexture>): void;\r\n    deleteTexture(texture: Nullable<WebGLTexture>): void;\r\n\r\n    createFramebuffer(texture: WebGLTexture, width: number, height: number, format: number, samplingMode: number, generateStencilBuffer: boolean, generateDepthBuffer: boolean, generateMipMaps: boolean): WebGLFramebuffer;\r\n    deleteFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n    bindFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n    unbindFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n\r\n    drawIndexed(fillMode: number, indexStart: number, indexCount: number): void;\r\n    draw(fillMode: number, vertexStart: number, vertexCount: number): void;\r\n\r\n    clear(flags: number): void;\r\n    clearColor(r: number, g: number, b: number, a: number): void;\r\n    clearDepth(depth: number): void;\r\n    clearStencil(stencil: number): void;\r\n\r\n    getRenderWidth(): number;\r\n    getRenderHeight(): number;\r\n\r\n    setViewPort(x: number, y: number, width: number, height: number): void;\r\n}\r\n\r\nclass NativePipelineContext implements IPipelineContext {\r\n    // TODO: async should be true?\r\n    public isAsync = false;\r\n    public isReady = false;\r\n\r\n    // TODO: what should this do?\r\n    public _handlesSpectorRebuildCallback(onCompiled: (compiledObject: any) => void): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    public nativeProgram: any;\r\n}\r\n\r\n/**\r\n * Container for accessors for natively-stored mesh data buffers.\r\n */\r\nclass NativeDataBuffer extends DataBuffer {\r\n    /**\r\n     * Accessor value used to identify/retrieve a natively-stored index buffer.\r\n     */\r\n    public nativeIndexBuffer?: any;\r\n\r\n    /**\r\n     * Accessor value used to identify/retrieve a natively-stored vertex buffer.\r\n     */\r\n    public nativeVertexBuffer?: any;\r\n}\r\n\r\n// TODO: change this to match bgfx.\r\n// Must match Filter enum in SpectreEngine.h.\r\nclass NativeFilter {\r\n    public static readonly POINT = 0;\r\n    public static readonly MINPOINT_MAGPOINT_MIPPOINT = NativeFilter.POINT;\r\n    public static readonly BILINEAR = 1;\r\n    public static readonly MINLINEAR_MAGLINEAR_MIPPOINT = NativeFilter.BILINEAR;\r\n    public static readonly TRILINEAR = 2;\r\n    public static readonly MINLINEAR_MAGLINEAR_MIPLINEAR = NativeFilter.TRILINEAR;\r\n    public static readonly ANISOTROPIC = 3;\r\n    public static readonly POINT_COMPARE = 4;\r\n    public static readonly TRILINEAR_COMPARE = 5;\r\n    public static readonly MINBILINEAR_MAGPOINT = 6;\r\n    public static readonly MINLINEAR_MAGPOINT_MIPLINEAR = NativeFilter.MINBILINEAR_MAGPOINT;\r\n    public static readonly MINPOINT_MAGPOINT_MIPLINEAR = 7;\r\n    public static readonly MINPOINT_MAGLINEAR_MIPPOINT = 8;\r\n    public static readonly MINPOINT_MAGLINEAR_MIPLINEAR = 9;\r\n    public static readonly MINLINEAR_MAGPOINT_MIPPOINT = 10;\r\n}\r\n\r\n// these flags match bgfx.\r\nclass NativeClearFlags\r\n{\r\n    public static readonly CLEAR_COLOR = 1;\r\n    public static readonly CLEAR_DEPTH = 2;\r\n    public static readonly CLEAR_STENCIL = 4;\r\n}\r\n// TODO: change this to match bgfx.\r\n// Must match AddressMode enum in SpectreEngine.h.\r\nclass NativeAddressMode {\r\n    public static readonly WRAP = 0;\r\n    public static readonly MIRROR = 1;\r\n    public static readonly CLAMP = 2;\r\n    public static readonly BORDER = 3;\r\n    public static readonly MIRROR_ONCE = 4;\r\n}\r\n\r\nclass NativeTextureFormat {\r\n    public static readonly RGBA8 = 0;\r\n    public static readonly RGBA32F = 1;\r\n}\r\n\r\n/** @hidden */\r\nclass NativeTexture extends InternalTexture {\r\n    public getInternalTexture(): InternalTexture {\r\n        return this;\r\n    }\r\n\r\n    public getViewCount(): number {\r\n        return 1;\r\n    }\r\n}\r\n\r\n/** @hidden */\r\ndeclare var _native: any;\r\n\r\n/** @hidden */\r\nexport class NativeEngine extends Engine {\r\n    private readonly _native: INativeEngine = new _native.Engine();\r\n    /** Defines the invalid handle returned by bgfx when resource creation goes wrong */\r\n    private readonly INVALID_HANDLE = 65535;\r\n\r\n    public getHardwareScalingLevel(): number {\r\n        return 1.0;\r\n    }\r\n\r\n    public constructor() {\r\n        super(null);\r\n\r\n        this._webGLVersion = 2;\r\n        this.disableUniformBuffers = true;\r\n\r\n        // TODO: Initialize this more correctly based on the hardware capabilities.\r\n        // Init caps\r\n\r\n        this._caps = {\r\n            maxTexturesImageUnits: 16,\r\n            maxVertexTextureImageUnits: 16,\r\n            maxCombinedTexturesImageUnits: 32,\r\n            maxTextureSize: 512,\r\n            maxCubemapTextureSize: 512,\r\n            maxRenderTextureSize: 512,\r\n            maxVertexAttribs: 16,\r\n            maxVaryingVectors: 16,\r\n            maxFragmentUniformVectors: 16,\r\n            maxVertexUniformVectors: 16,\r\n            standardDerivatives: true,\r\n            astc: null,\r\n            pvrtc: null,\r\n            etc1: null,\r\n            etc2: null,\r\n            maxAnisotropy: 16,  // TODO: Retrieve this smartly. Currently set to D3D11 maximum allowable value.\r\n            uintIndices: false,\r\n            fragmentDepthSupported: false,\r\n            highPrecisionShaderSupported: true,\r\n            colorBufferFloat: false,\r\n            textureFloat: false,\r\n            textureFloatLinearFiltering: false,\r\n            textureFloatRender: false,\r\n            textureHalfFloat: false,\r\n            textureHalfFloatLinearFiltering: false,\r\n            textureHalfFloatRender: false,\r\n            textureLOD: true,\r\n            drawBuffersExtension: false,\r\n            depthTextureExtension: false,\r\n            vertexArrayObject: true,\r\n            instancedArrays: false,\r\n            canUseTimestampForTimerQuery: false,\r\n            blendMinMax: false,\r\n            maxMSAASamples: 1\r\n        };\r\n\r\n        Tools.Log(\"Babylon Native (v\" + Engine.Version + \") launched\");\r\n\r\n        // Wrappers\r\n        if (typeof URL === \"undefined\") {\r\n            (window.URL as any) = {\r\n                createObjectURL: function() { },\r\n                revokeObjectURL: function() { }\r\n            };\r\n        }\r\n\r\n        if (typeof Blob === \"undefined\") {\r\n            (window.Blob as any) = function() { };\r\n        }\r\n\r\n        // Shader processor\r\n        this._shaderProcessor = new NativeShaderProcessor();\r\n    }\r\n\r\n    /**\r\n     * Can be used to override the current requestAnimationFrame requester.\r\n     * @hidden\r\n     */\r\n    protected _queueNewFrame(bindedRenderFunction: any, requester?: any): number {\r\n        if (requester.requestAnimationFrame) {\r\n            requester.requestAnimationFrame(bindedRenderFunction);\r\n        } else {\r\n            this._native.requestAnimationFrame(bindedRenderFunction);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Override default engine behavior.\r\n     * @param color\r\n     * @param backBuffer\r\n     * @param depth\r\n     * @param stencil\r\n     */\r\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\r\n        if (this._currentFramebuffer !== framebuffer) {\r\n            if (this._currentFramebuffer) {\r\n                this._native.unbindFramebuffer(this._currentFramebuffer!);\r\n            }\r\n\r\n            if (framebuffer) {\r\n                this._native.bindFramebuffer(framebuffer);\r\n            }\r\n\r\n            this._currentFramebuffer = framebuffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets host document\r\n     * @returns the host document object\r\n     */\r\n    public getHostDocument(): Nullable<Document> {\r\n        return null;\r\n    }\r\n\r\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        var mode = 0;\r\n        if (backBuffer && color) {\r\n            this._native.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\r\n            mode |= NativeClearFlags.CLEAR_COLOR;\r\n        }\r\n        if (depth) {\r\n            this._native.clearDepth(1.0);\r\n            mode |= NativeClearFlags.CLEAR_DEPTH;\r\n        }\r\n        if (stencil) {\r\n            this._native.clearStencil(0);\r\n            mode |= NativeClearFlags.CLEAR_STENCIL;\r\n        }\r\n        this._native.clear(mode);\r\n    }\r\n\r\n    public createIndexBuffer(indices: IndicesArray): NativeDataBuffer {\r\n        const data = this._normalizeIndexData(indices);\r\n        const buffer = new NativeDataBuffer();\r\n        buffer.references = 1;\r\n        buffer.is32Bits = (data.BYTES_PER_ELEMENT === 4);\r\n        buffer.nativeIndexBuffer = this._native.createIndexBuffer(data);\r\n        if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\r\n            throw new Error(\"Could not create a native index buffer.\");\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    public createVertexBuffer(data: DataArray): NativeDataBuffer {\r\n        const buffer = new NativeDataBuffer();\r\n        buffer.references = 1;\r\n        buffer.nativeVertexBuffer = this._native.createVertexBuffer(ArrayBuffer.isView(data) ? data : new Float32Array(data));\r\n        if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\r\n            throw new Error(\"Could not create a native vertex buffer.\");\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    public recordVertexArrayObject(vertexBuffers: { [key: string]: VertexBuffer; }, indexBuffer: Nullable<NativeDataBuffer>, effect: Effect): WebGLVertexArrayObject {\r\n        const vertexArray = this._native.createVertexArray();\r\n\r\n        if (indexBuffer) {\r\n            this._native.recordIndexBuffer(vertexArray, indexBuffer.nativeIndexBuffer);\r\n        }\r\n\r\n        const attributes = effect.getAttributesNames();\r\n        for (let index = 0; index < attributes.length; index++) {\r\n            const location = effect.getAttributeLocation(index);\r\n            if (location >= 0) {\r\n                const kind = attributes[index];\r\n                const vertexBuffer = vertexBuffers[kind];\r\n                if (vertexBuffer) {\r\n                    const buffer = vertexBuffer.getBuffer() as Nullable<NativeDataBuffer>;\r\n                    if (buffer) {\r\n                        this._native.recordVertexBuffer(vertexArray, buffer.nativeVertexBuffer, location, vertexBuffer.byteOffset, vertexBuffer.byteStride, vertexBuffer.getSize(), vertexBuffer.type, vertexBuffer.normalized);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return vertexArray;\r\n    }\r\n\r\n    public bindVertexArrayObject(vertexArray: WebGLVertexArrayObject): void {\r\n        this._native.bindVertexArray(vertexArray);\r\n    }\r\n\r\n    public releaseVertexArrayObject(vertexArray: WebGLVertexArrayObject) {\r\n        this._native.deleteVertexArray(vertexArray);\r\n    }\r\n\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n        return this._native.getAttributes(nativePipelineContext.nativeProgram, attributesNames);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this._drawCalls.addCount(1, false);\r\n\r\n        // TODO: Make this implementation more robust like core Engine version.\r\n\r\n        // Render\r\n        //var indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\r\n\r\n        //var mult = this._uintIndicesCurrentlySet ? 4 : 2;\r\n        // if (instancesCount) {\r\n        //     this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\r\n        // } else {\r\n        this._native.drawIndexed(fillMode, indexStart, indexCount);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this._drawCalls.addCount(1, false);\r\n\r\n        // TODO: Make this implementation more robust like core Engine version.\r\n\r\n        // if (instancesCount) {\r\n        //     this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\r\n        // } else {\r\n        this._native.draw(fillMode, verticesStart, verticesCount);\r\n        // }\r\n    }\r\n\r\n    public createPipelineContext(): IPipelineContext {\r\n        return new NativePipelineContext();\r\n    }\r\n\r\n    public _preparePipelineContext(pipelineContext: IPipelineContext, vertexSourceCode: string, fragmentSourceCode: string, createAsRaw: boolean, rebuildRebind: any, defines: Nullable<string>, transformFeedbackVaryings: Nullable<string[]>) {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n\r\n        if (createAsRaw) {\r\n            nativePipelineContext.nativeProgram = this.createRawShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\r\n        }\r\n        else {\r\n            nativePipelineContext.nativeProgram = this.createShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\r\n        // TODO: support async shader compilcation\r\n        return true;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        // TODO: support async shader compilcation\r\n        action();\r\n    }\r\n\r\n    public createRawShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): any {\r\n        throw new Error(\"Not Supported\");\r\n    }\r\n\r\n    public createShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, defines: Nullable<string>, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): any {\r\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\r\n        const program = this._native.createProgram(\r\n            ThinEngine._ConcatenateShader(vertexCode, defines),\r\n            ThinEngine._ConcatenateShader(fragmentCode, defines)\r\n        );\r\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\r\n        return program;\r\n    }\r\n\r\n    protected _setProgram(program: WebGLProgram): void {\r\n        if (this._currentProgram !== program) {\r\n            this._native.setProgram(program);\r\n            this._currentProgram = program;\r\n        }\r\n    }\r\n\r\n    public _releaseEffect(effect: Effect): void {\r\n        // TODO\r\n    }\r\n\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        // TODO\r\n    }\r\n\r\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): WebGLUniformLocation[] {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n        return this._native.getUniforms(nativePipelineContext.nativeProgram, uniformsNames);\r\n    }\r\n\r\n    public bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void {\r\n        // TODO\r\n        throw new Error(\"Not Implemented\");\r\n    }\r\n\r\n    public bindSamplers(effect: Effect): void {\r\n        const nativePipelineContext = effect.getPipelineContext() as NativePipelineContext;\r\n        this._setProgram(nativePipelineContext.nativeProgram);\r\n\r\n        // TODO: share this with engine?\r\n        var samplers = effect.getSamplers();\r\n        for (var index = 0; index < samplers.length; index++) {\r\n            var uniform = effect.getUniform(samplers[index]);\r\n\r\n            if (uniform) {\r\n                this._boundUniforms[index] = uniform;\r\n            }\r\n        }\r\n        this._currentEffect = null;\r\n    }\r\n\r\n    public setMatrix(uniform: WebGLUniformLocation, matrix: Matrix): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setMatrix(uniform, matrix.toArray() as Float32Array);\r\n    }\r\n\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._native.getRenderWidth();\r\n    }\r\n\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._native.getRenderHeight();\r\n    }\r\n\r\n    public setViewport(viewport: Viewport, requiredWidth?: number, requiredHeight?: number): void {\r\n        this._cachedViewport = viewport;\r\n        this._native.setViewPort(viewport.x, viewport.y, viewport.width, viewport.height);\r\n    }\r\n\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false): void {\r\n        this._native.setState(culling, zOffset, reverseSide);\r\n    }\r\n\r\n    /**\r\n     * Set the z offset to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffset(value: number): void {\r\n        this._native.setZOffset(value);\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset\r\n     * @returns the current zOffset state\r\n     */\r\n    public getZOffset(): number {\r\n        return this._native.getZOffset();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth buffering\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthBuffer(enable: boolean): void {\r\n        this._native.setDepthTest(enable);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if depth writing is enabled\r\n     * @returns the current depth writing state\r\n     */\r\n    public getDepthWrite(): boolean {\r\n        return this._native.getDepthWrite();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthWrite(enable: boolean): void {\r\n        this._native.setDepthWrite(enable);\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        this._native.setColorWrite(enable);\r\n        this._colorWrite = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWrite;\r\n    }\r\n\r\n    /**\r\n     * Sets alpha constants used by some alpha blending modes\r\n     * @param r defines the red component\r\n     * @param g defines the green component\r\n     * @param b defines the blue component\r\n     * @param a defines the alpha component\r\n     */\r\n    public setAlphaConstants(r: number, g: number, b: number, a: number) {\r\n        throw new Error(\"Setting alpha blend constant color not yet implemented.\");\r\n    }\r\n\r\n    /**\r\n     * Sets the current alpha mode\r\n     * @param mode defines the mode to use (one of the BABYLON.undefined)\r\n     * @param noDepthWriteChange defines if depth writing state should remains unchanged (false by default)\r\n     * @see http://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     */\r\n    public setAlphaMode(mode: number, noDepthWriteChange: boolean = false): void {\r\n        if (this._alphaMode === mode) {\r\n            return;\r\n        }\r\n\r\n        this._native.setBlendMode(mode);\r\n\r\n        if (!noDepthWriteChange) {\r\n            this.setDepthWrite(mode === 0);\r\n        }\r\n\r\n        this._alphaMode = mode;\r\n    }\r\n\r\n    /**\r\n     * Gets the current alpha mode\r\n     * @see http://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     * @returns the current alpha mode\r\n     */\r\n    public getAlphaMode(): number {\r\n        return this._alphaMode;\r\n    }\r\n\r\n    public setInt(uniform: WebGLUniformLocation, int: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setInt(uniform, int);\r\n    }\r\n\r\n    public setIntArray(uniform: WebGLUniformLocation, array: Int32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setIntArray(uniform, array);\r\n    }\r\n\r\n    public setIntArray2(uniform: WebGLUniformLocation, array: Int32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setIntArray2(uniform, array);\r\n    }\r\n\r\n    public setIntArray3(uniform: WebGLUniformLocation, array: Int32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setIntArray3(uniform, array);\r\n    }\r\n\r\n    public setIntArray4(uniform: WebGLUniformLocation, array: Int32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setIntArray4(uniform, array);\r\n    }\r\n\r\n    public setFloatArray(uniform: WebGLUniformLocation, array: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray(uniform, array);\r\n    }\r\n\r\n    public setFloatArray2(uniform: WebGLUniformLocation, array: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray2(uniform, array);\r\n    }\r\n\r\n    public setFloatArray3(uniform: WebGLUniformLocation, array: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray3(uniform, array);\r\n    }\r\n\r\n    public setFloatArray4(uniform: WebGLUniformLocation, array: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray4(uniform, array);\r\n    }\r\n\r\n    public setArray(uniform: WebGLUniformLocation, array: number[]): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray(uniform, array);\r\n    }\r\n\r\n    public setArray2(uniform: WebGLUniformLocation, array: number[]): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray2(uniform, array);\r\n    }\r\n\r\n    public setArray3(uniform: WebGLUniformLocation, array: number[]): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray3(uniform, array);\r\n    }\r\n\r\n    public setArray4(uniform: WebGLUniformLocation, array: number[]): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloatArray4(uniform, array);\r\n    }\r\n\r\n    public setMatrices(uniform: WebGLUniformLocation, matrices: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setMatrices(uniform, matrices);\r\n    }\r\n\r\n    public setMatrix3x3(uniform: WebGLUniformLocation, matrix: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setMatrix3x3(uniform, matrix);\r\n    }\r\n\r\n    public setMatrix2x2(uniform: WebGLUniformLocation, matrix: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setMatrix2x2(uniform, matrix);\r\n    }\r\n\r\n    public setFloat(uniform: WebGLUniformLocation, value: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat(uniform, value);\r\n    }\r\n\r\n    public setFloat2(uniform: WebGLUniformLocation, x: number, y: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat2(uniform, x, y);\r\n    }\r\n\r\n    public setFloat3(uniform: WebGLUniformLocation, x: number, y: number, z: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat3(uniform, x, y, z);\r\n    }\r\n\r\n    public setFloat4(uniform: WebGLUniformLocation, x: number, y: number, z: number, w: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat4(uniform, x, y, z, w);\r\n    }\r\n\r\n    public setColor3(uniform: WebGLUniformLocation, color3: Color3): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat3(uniform, color3.r, color3.g, color3.b);\r\n    }\r\n\r\n    public setColor4(uniform: WebGLUniformLocation, color3: Color3, alpha: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setFloat4(uniform, color3.r, color3.g, color3.b, alpha);\r\n    }\r\n\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames) {\r\n            return;\r\n        }\r\n        this.resetTextureCache();\r\n        this._currentEffect = null;\r\n\r\n        if (bruteForce) {\r\n            this._currentProgram = null;\r\n\r\n            this._stencilState.reset();\r\n            this._depthCullingState.reset();\r\n            this._alphaState.reset();\r\n        }\r\n\r\n        this._cachedVertexBuffers = null;\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n    }\r\n\r\n    public _createTexture(): WebGLTexture {\r\n        return this._native.createTexture();\r\n    }\r\n\r\n    protected _deleteTexture(texture: Nullable<WebGLTexture>): void {\r\n        this._native.deleteTexture(texture);\r\n    }\r\n\r\n    // TODO: Refactor to share more logic with babylon.engine.ts version.\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param urlArg defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(urlArg: Nullable<string>, noMipmap: boolean, invertY: boolean, scene: Nullable<ISceneLike>, samplingMode: number = 3,\r\n        onLoad: Nullable<() => void> = null, onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null, fallback: Nullable<InternalTexture> = null, format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null, mimeType?: string): InternalTexture {\r\n        var url = String(urlArg); // assign a new string, so that the original is still available in case of fallback\r\n        var fromData = url.substr(0, 5) === \"data:\";\r\n        var fromBlob = url.substr(0, 5) === \"blob:\";\r\n\r\n        let texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\r\n\r\n        // establish the file extension, if possible\r\n        var lastDot = url.lastIndexOf('.');\r\n        var extension = forcedExtension ? forcedExtension : (lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\");\r\n\r\n        let loader: Nullable<IInternalTextureLoader> = null;\r\n        for (let availableLoader of Engine._TextureLoaders) {\r\n            if (availableLoader.canLoad(extension)) {\r\n                loader = availableLoader;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (scene) {\r\n            scene._addPendingData(texture);\r\n        }\r\n        texture.url = url;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture.samplingMode = samplingMode;\r\n        texture.invertY = invertY;\r\n\r\n        if (!this.doNotHandleContextLost) {\r\n            // Keep a link to the buffer only if we plan to handle context lost\r\n            texture._buffer = buffer;\r\n        }\r\n\r\n        let onLoadObserver: Nullable<Observer<InternalTexture>> = null;\r\n        if (onLoad && !fallback) {\r\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\r\n        }\r\n\r\n        if (!fallback) { this._internalTexturesCache.push(texture); }\r\n\r\n        let onInternalError = (message?: string, exception?: any) => {\r\n            if (scene) {\r\n                scene._removePendingData(texture);\r\n            }\r\n\r\n            if (onLoadObserver) {\r\n                texture.onLoadedObservable.remove(onLoadObserver);\r\n            }\r\n            if (Tools.UseFallbackTexture) {\r\n                this.createTexture(Tools.fallbackTexture, noMipmap, invertY, scene, samplingMode, null, onError, buffer, texture);\r\n            }\r\n\r\n            if (onError) {\r\n                onError(message || \"Unknown error\", exception);\r\n            }\r\n        };\r\n\r\n        // processing for non-image formats\r\n        if (loader) {\r\n            throw new Error(\"Loading textures from IInternalTextureLoader not yet implemented.\");\r\n            // var callback = (data: string | ArrayBuffer) => {\r\n            //     loader!.loadData(data as ArrayBuffer, texture, (width: number, height: number, loadMipmap: boolean, isCompressed: boolean, done: () => void) => {\r\n            //         this._prepareWebGLTexture(texture, scene, width, height, invertY, !loadMipmap, isCompressed, () => {\r\n            //                 done();\r\n            //                 return false;\r\n            //             },\r\n            //             samplingMode);\r\n            //     });\r\n            // }\r\n\r\n            // if (!buffer) {\r\n            //     this._loadFile(url, callback, undefined, scene ? scene.database : undefined, true, (request?: XMLHttpRequest, exception?: any) => {\r\n            //         onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\r\n            //     });\r\n            // } else {\r\n            //     callback(buffer as ArrayBuffer);\r\n            // }\r\n        } else {\r\n            var onload = (data: string | ArrayBuffer | Blob, responseURL?: string) => {\r\n                if (typeof (data) === \"string\") {\r\n                    throw new Error(\"Loading textures from string data not yet implemented.\");\r\n                }\r\n\r\n                if (fromBlob && !this.doNotHandleContextLost) {\r\n                    // We need to store the image if we need to rebuild the texture\r\n                    // in case of a webgl context lost\r\n                    texture._buffer = data;\r\n                }\r\n\r\n                let webGLTexture = texture._webGLTexture;\r\n\r\n                if (!webGLTexture) {\r\n                    //  this.resetTextureCache();\r\n                    if (scene) {\r\n                        scene._removePendingData(texture);\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                if (!this._native.loadTexture(webGLTexture, data, !noMipmap, invertY)) {\r\n                    throw new Error(\"Could not load a native texture.\");\r\n                }\r\n\r\n                texture.baseWidth = this._native.getTextureWidth(webGLTexture);\r\n                texture.baseHeight = this._native.getTextureHeight(webGLTexture);\r\n                texture.width = texture.baseWidth;\r\n                texture.height = texture.baseHeight;\r\n                texture.isReady = true;\r\n\r\n                var filter = this._getSamplingFilter(samplingMode);\r\n\r\n                this._native.setTextureSampling(webGLTexture, filter);\r\n\r\n                // this.resetTextureCache();\r\n                if (scene) {\r\n                    scene._removePendingData(texture);\r\n                }\r\n\r\n                texture.onLoadedObservable.notifyObservers(texture);\r\n                texture.onLoadedObservable.clear();\r\n            };\r\n\r\n            if (buffer instanceof ArrayBuffer) {\r\n                onload(buffer);\r\n            } else if (ArrayBuffer.isView(buffer)) {\r\n                onload(buffer.buffer);\r\n            } else if (buffer instanceof Blob) {\r\n                throw new Error(\"Loading texture from Blob not yet implemented.\");\r\n            } else if (!fromData) {\r\n                let onLoadFileError = (request?: WebRequest, exception?: any) => {\r\n                    onInternalError(\"Failed to retrieve \" + url + \".\", exception);\r\n                };\r\n                Tools.LoadFile(url, onload, undefined, undefined, /*useArrayBuffer*/true, onLoadFileError);\r\n            } else {\r\n                onload(Tools.DecodeBase64(buffer as string));\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates a cube texture\r\n     * @param rootUrl defines the url where the files to load is located\r\n     * @param scene defines the current scene\r\n     * @param files defines the list of files to load (1 per face)\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated (false by default)\r\n     * @param onLoad defines an optional callback raised when the texture is loaded\r\n     * @param onError defines an optional callback raised if there is an issue to load the texture\r\n     * @param format defines the format of the data\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param createPolynomials if a polynomial sphere should be created for the cube texture\r\n     * @param lodScale defines the scale applied to environment texture. This manages the range of LOD level used for IBL according to the roughness\r\n     * @param lodOffset defines the offset applied to environment texture. This manages first LOD level used for IBL according to the roughness\r\n     * @param fallback defines texture to use while falling back when (compressed) texture file not found.\r\n     * @returns the cube texture as an InternalTexture\r\n     */\r\n    public createCubeTexture(\r\n        rootUrl: string,\r\n        scene: Nullable<Scene>,\r\n        files: Nullable<string[]>,\r\n        noMipmap?: boolean,\r\n        onLoad: Nullable<(data?: any) => void> = null,\r\n        onError: Nullable<(message?: string, exception?: any) => void> = null,\r\n        format?: number,\r\n        forcedExtension: any = null,\r\n        createPolynomials = false,\r\n        lodScale: number = 0,\r\n        lodOffset: number = 0,\r\n        fallback: Nullable<InternalTexture> = null): InternalTexture\r\n    {\r\n        var texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Cube);\r\n        texture.isCube = true;\r\n        texture.url = rootUrl;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture._lodGenerationScale = lodScale;\r\n        texture._lodGenerationOffset = lodOffset;\r\n\r\n        if (!this._doNotHandleContextLost) {\r\n            texture._extension = forcedExtension;\r\n            texture._files = files;\r\n        }\r\n\r\n        var lastDot = rootUrl.lastIndexOf('.');\r\n        var extension = forcedExtension ? forcedExtension : (lastDot > -1 ? rootUrl.substring(lastDot).toLowerCase() : \"\");\r\n\r\n        // TODO: use texture loader to load env files?\r\n        if (extension === \".env\") {\r\n            const onloaddata = (data: ArrayBufferView) => {\r\n                var info = EnvironmentTextureTools.GetEnvInfo(data)!;\r\n                texture.width = info.width;\r\n                texture.height = info.width;\r\n\r\n                EnvironmentTextureTools.UploadEnvSpherical(texture, info);\r\n\r\n                if (info.version !== 1) {\r\n                    throw new Error(`Unsupported babylon environment map version \"${info.version}\"`);\r\n                }\r\n\r\n                let specularInfo = info.specular as EnvironmentTextureSpecularInfoV1;\r\n                if (!specularInfo) {\r\n                    throw new Error(`Nothing else parsed so far`);\r\n                }\r\n\r\n                texture._lodGenerationScale = specularInfo.lodGenerationScale;\r\n                const imageData = EnvironmentTextureTools.CreateImageDataArrayBufferViews(data, info);\r\n\r\n                texture.format = 5;\r\n                texture.type = 0;\r\n                texture.generateMipMaps = true;\r\n                texture.getEngine().updateTextureSamplingMode(Texture.TRILINEAR_SAMPLINGMODE, texture);\r\n                texture._isRGBD = true;\r\n                texture.invertY = true;\r\n                if (!this._native.loadEnvTexture(texture._webGLTexture!, imageData)) {\r\n                    throw new Error(\"Could not load a native cube texture.\");\r\n                }\r\n\r\n                texture.isReady = true;\r\n                if (onLoad) {\r\n                    onLoad();\r\n                }\r\n            };\r\n            if (files && files.length === 6) {\r\n                throw new Error(`Multi-file loading not allowed on env files.`);\r\n            }\r\n            else {\r\n                let onInternalError = (request?: IWebRequest, exception?: any) => {\r\n                    if (onError && request) {\r\n                        onError(request.status + \" \" + request.statusText, exception);\r\n                    }\r\n                };\r\n\r\n                this._loadFile(rootUrl, (data) => onloaddata(new Uint8Array(data as ArrayBuffer)), undefined, undefined, true, onInternalError);\r\n            }\r\n        }\r\n        else {\r\n            if (!files || files.length !== 6) {\r\n                throw new Error(\"Cannot load cubemap because 6 files were not defined\");\r\n            }\r\n\r\n            // Reorder from [+X, +Y, +Z, -X, -Y, -Z] to [+X, -X, +Y, -Y, +Z, -Z].\r\n            const reorderedFiles = [files[0], files[3], files[1], files[4], files[2], files[5]];\r\n            Promise.all(reorderedFiles.map((file) => Tools.LoadFileAsync(file).then((data) => new Uint8Array(data as ArrayBuffer)))).then((data) => {\r\n                this._native.loadCubeTexture(texture._webGLTexture!, data, !noMipmap);\r\n            }).then(() => {\r\n                texture.isReady = true;\r\n                if (onLoad) {\r\n                    onLoad();\r\n                }\r\n            }, (error) => {\r\n                if (onError) {\r\n                    onError(`Failed to load cubemap: ${error.message}`, error);\r\n                }\r\n            });\r\n        }\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    // Returns a NativeFilter.XXXX value.\r\n    private _getSamplingFilter(samplingMode: number): number {\r\n        switch (samplingMode) {\r\n            case 2:\r\n                return NativeFilter.MINLINEAR_MAGLINEAR_MIPPOINT;\r\n            case 3:\r\n                return NativeFilter.MINLINEAR_MAGLINEAR_MIPLINEAR;\r\n            case 1:\r\n                return NativeFilter.MINPOINT_MAGPOINT_MIPLINEAR;\r\n            case 4:\r\n                return NativeFilter.MINPOINT_MAGPOINT_MIPPOINT;\r\n            case 5:\r\n                return NativeFilter.MINLINEAR_MAGPOINT_MIPPOINT;\r\n            case 6:\r\n                return NativeFilter.MINLINEAR_MAGPOINT_MIPLINEAR;\r\n            case 7:\r\n                return NativeFilter.MINLINEAR_MAGPOINT_MIPLINEAR;\r\n            case 1:\r\n                return NativeFilter.MINPOINT_MAGPOINT_MIPPOINT;\r\n            case 9:\r\n                return NativeFilter.MINPOINT_MAGLINEAR_MIPPOINT;\r\n            case 10:\r\n                return NativeFilter.MINPOINT_MAGLINEAR_MIPLINEAR;\r\n            case 2:\r\n                return NativeFilter.MINLINEAR_MAGLINEAR_MIPLINEAR;\r\n            case 12:\r\n                return NativeFilter.MINPOINT_MAGLINEAR_MIPLINEAR;\r\n            default:\r\n                throw new Error(\"Unexpected sampling mode: \" + samplingMode + \".\");\r\n        }\r\n    }\r\n\r\n    private static _GetNativeTextureFormat(format: number, type: number): number {\r\n        if (format == 5 && type == 0) {\r\n            return NativeTextureFormat.RGBA8;\r\n        }\r\n        else if (format == 5 && type == 1) {\r\n            return NativeTextureFormat.RGBA32F;\r\n        }\r\n        else {\r\n            throw new Error(\"Unexpected texture format or type: format \" + format + \", type \" + type + \".\");\r\n        }\r\n    }\r\n\r\n    public createRenderTargetTexture(size: number | { width: number, height: number }, options: boolean | RenderTargetCreationOptions): NativeTexture {\r\n        let fullOptions = new RenderTargetCreationOptions();\r\n\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            fullOptions.generateMipMaps = options.generateMipMaps;\r\n            fullOptions.generateDepthBuffer = options.generateDepthBuffer === undefined ? true : options.generateDepthBuffer;\r\n            fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && options.generateStencilBuffer;\r\n            fullOptions.type = options.type === undefined ? 0 : options.type;\r\n            fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\r\n            fullOptions.format = options.format === undefined ? 5 : options.format;\r\n        } else {\r\n            fullOptions.generateMipMaps = <boolean>options;\r\n            fullOptions.generateDepthBuffer = true;\r\n            fullOptions.generateStencilBuffer = false;\r\n            fullOptions.type = 0;\r\n            fullOptions.samplingMode = 3;\r\n            fullOptions.format = 5;\r\n        }\r\n\r\n        if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\r\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = 1;\r\n        }\r\n        else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\r\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = 1;\r\n        }\r\n        var texture = new NativeTexture(this, InternalTextureSource.RenderTarget);\r\n\r\n        var width = (<{ width: number, height: number }>size).width || <number>size;\r\n        var height = (<{ width: number, height: number }>size).height || <number>size;\r\n\r\n        if (fullOptions.type === 1 && !this._caps.textureFloat) {\r\n            fullOptions.type = 0;\r\n            Logger.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\");\r\n        }\r\n\r\n        var framebuffer = this._native.createFramebuffer(\r\n            texture._webGLTexture!,\r\n            width,\r\n            height,\r\n            NativeEngine._GetNativeTextureFormat(fullOptions.format, fullOptions.type),\r\n            fullOptions.samplingMode!,\r\n            fullOptions.generateStencilBuffer ? true : false,\r\n            fullOptions.generateDepthBuffer,\r\n            fullOptions.generateMipMaps ? true : false);\r\n\r\n        texture._framebuffer = framebuffer;\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.isReady = true;\r\n        texture.samples = 1;\r\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\r\n        texture.samplingMode = fullOptions.samplingMode;\r\n        texture.type = fullOptions.type;\r\n        texture.format = fullOptions.format;\r\n        texture._generateDepthBuffer = fullOptions.generateDepthBuffer;\r\n        texture._generateStencilBuffer = fullOptions.generateStencilBuffer ? true : false;\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture): void {\r\n        if (texture._webGLTexture) {\r\n            var filter = this._getSamplingFilter(samplingMode);\r\n            this._native.setTextureSampling(texture._webGLTexture, filter);\r\n        }\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    public bindFramebuffer(texture: InternalTexture, faceIndex?: number, requiredWidth?: number, requiredHeight?: number, forceFullscreenViewport?: boolean): void {\r\n        if (faceIndex) {\r\n            throw new Error(\"Cuboid frame buffers are not yet supported in NativeEngine.\");\r\n        }\r\n\r\n        if (requiredWidth || requiredHeight) {\r\n            throw new Error(\"Required width/height for frame buffers not yet supported in NativeEngine.\");\r\n        }\r\n\r\n        if (forceFullscreenViewport) {\r\n            throw new Error(\"forceFullscreenViewport for frame buffers not yet supported in NativeEngine.\");\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(texture._framebuffer);\r\n    }\r\n\r\n    public unBindFramebuffer(texture: InternalTexture, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        if (disableGenerateMipMaps) {\r\n            Logger.Warn(\"Disabling mipmap generation not yet supported in NativeEngine. Ignoring.\");\r\n        }\r\n\r\n        if (onBeforeUnbind) {\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    public createDynamicVertexBuffer(data: DataArray): DataBuffer {\r\n        throw new Error(\"createDynamicVertexBuffer not yet implemented.\");\r\n    }\r\n\r\n    public updateDynamicIndexBuffer(indexBuffer: DataBuffer, indices: IndicesArray, offset: number = 0): void {\r\n        throw new Error(\"updateDynamicIndexBuffer not yet implemented.\");\r\n    }\r\n\r\n    /**\r\n     * Updates a dynamic vertex buffer.\r\n     * @param vertexBuffer the vertex buffer to update\r\n     * @param data the data used to update the vertex buffer\r\n     * @param byteOffset the byte offset of the data (optional)\r\n     * @param byteLength the byte length of the data (optional)\r\n     */\r\n    public updateDynamicVertexBuffer(vertexBuffer: DataBuffer, data: DataArray, byteOffset?: number, byteLength?: number): void {\r\n        throw new Error(\"updateDynamicVertexBuffer not yet implemented.\");\r\n    }\r\n\r\n    // TODO: Refactor to share more logic with base Engine implementation.\r\n    protected _setTexture(channel: number, texture: Nullable<BaseTexture>, isPartOfTextureArray = false, depthStencilTexture = false): boolean {\r\n        let uniform = this._boundUniforms[channel];\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        // Not ready?\r\n        if (!texture) {\r\n            if (this._boundTexturesCache[channel] != null) {\r\n                this._activeChannel = channel;\r\n                this._native.setTexture(uniform, null);\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // Video\r\n        if ((<VideoTexture>texture).video) {\r\n            this._activeChannel = channel;\r\n            (<VideoTexture>texture).update();\r\n        } else if (texture.delayLoadState === 4) { // Delay loading\r\n            texture.delayLoad();\r\n            return false;\r\n        }\r\n\r\n        let internalTexture: InternalTexture;\r\n        if (depthStencilTexture) {\r\n            internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n        } else if (texture.isReady()) {\r\n            internalTexture = <InternalTexture>texture.getInternalTexture();\r\n        } else if (texture.isCube) {\r\n            internalTexture = this.emptyCubeTexture;\r\n        } else if (texture.is3D) {\r\n            internalTexture = this.emptyTexture3D;\r\n        } else if (texture.is2DArray) {\r\n            internalTexture = this.emptyTexture2DArray;\r\n        } else {\r\n            internalTexture = this.emptyTexture;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n\r\n        if (!internalTexture ||\r\n            !internalTexture._webGLTexture) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setTextureWrapMode(\r\n            internalTexture._webGLTexture,\r\n            this._getAddressMode(texture.wrapU),\r\n            this._getAddressMode(texture.wrapV),\r\n            this._getAddressMode(texture.wrapR));\r\n        this._updateAnisotropicLevel(texture);\r\n\r\n        this._native.setTexture(uniform, internalTexture._webGLTexture);\r\n\r\n        return true;\r\n    }\r\n\r\n    // TODO: Share more of this logic with the base implementation.\r\n    // TODO: Rename to match naming in base implementation once refactoring allows different parameters.\r\n    private _updateAnisotropicLevel(texture: BaseTexture) {\r\n        var internalTexture = texture.getInternalTexture();\r\n        var value = texture.anisotropicFilteringLevel;\r\n\r\n        if (!internalTexture || !internalTexture._webGLTexture) {\r\n            return;\r\n        }\r\n\r\n        if (internalTexture._cachedAnisotropicFilteringLevel !== value) {\r\n            this._native.setTextureAnisotropicLevel(internalTexture._webGLTexture, value);\r\n            internalTexture._cachedAnisotropicFilteringLevel = value;\r\n        }\r\n    }\r\n\r\n    // Returns a NativeAddressMode.XXX value.\r\n    private _getAddressMode(wrapMode: number): number {\r\n        switch (wrapMode) {\r\n            case 1:\r\n                return NativeAddressMode.WRAP;\r\n            case 0:\r\n                return NativeAddressMode.CLAMP;\r\n            case 2:\r\n                return NativeAddressMode.MIRROR;\r\n            default:\r\n                throw new Error(\"Unexpected wrap mode: \" + wrapMode + \".\");\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _bindTexture(channel: number, texture: InternalTexture): void {\r\n        throw new Error(\"_bindTexture not implemented.\");\r\n    }\r\n\r\n    protected _deleteBuffer(buffer: NativeDataBuffer): void {\r\n        if (buffer.nativeIndexBuffer) {\r\n            this._native.deleteIndexBuffer(buffer.nativeIndexBuffer);\r\n            delete buffer.nativeIndexBuffer;\r\n        }\r\n\r\n        if (buffer.nativeVertexBuffer) {\r\n            this._native.deleteVertexBuffer(buffer.nativeVertexBuffer);\r\n            delete buffer.nativeVertexBuffer;\r\n        }\r\n    }\r\n\r\n    public releaseEffects() {\r\n        // TODO\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadCompressedDataToTextureDirectly(texture: InternalTexture, internalFormat: number, width: number, height: number, data: ArrayBufferView, faceIndex: number = 0, lod: number = 0) {\r\n        throw new Error(\"_uploadCompressedDataToTextureDirectly not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadDataToTextureDirectly(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        throw new Error(\"_uploadDataToTextureDirectly not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadImageToTexture(texture: InternalTexture, image: HTMLImageElement, faceIndex: number = 0, lod: number = 0) {\r\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\r\n    }\r\n}\r\n"]}